<!DOCTYPE html>
<html>
<head>
  <style>
    * { margin: 0; padding: 0; }
    body { background: transparent; }
    canvas { display: block; }
    .controls {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      padding: 8px 12px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 14px;
      color: white;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    input[type="range"] {
      width: 120px;
      cursor: pointer;
    }
    .bpm-value {
      min-width: 70px;
    }
  </style>
</head>
<body>
  <canvas id="c" width="128" height="128"></canvas>
  <div class="controls">
    <input type="range" id="bpmSlider" min="60" max="180" value="116">
    <span class="bpm-value"><span id="bpmDisplay">116</span> BPM</span>
  </div>
  <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const slider = document.getElementById('bpmSlider');
    const display = document.getElementById('bpmDisplay');

    let BPM = 116;

    slider.addEventListener('input', (e) => {
      BPM = parseInt(e.target.value);
      display.textContent = BPM;
    });

    function draw(time) {
      const beatDuration = 60000 / BPM;
      const t = (time % beatDuration) / beatDuration; // 0 to 1 over one beat

      // Sharp attack, slow release
      // First 15%: quick drop down
      // Remaining 85%: slow ease back up
      let bob;
      if (t < 0.15) {
        // Quick drop (linear)
        bob = (t / 0.15) * 6;
      } else {
        // Slow rise back (ease-out cubic)
        const releaseT = (t - 0.15) / 0.85;
        bob = 6 * (1 - Math.pow(releaseT, 0.5));
      }

      ctx.clearRect(0, 0, 128, 128);

      // Steam (behind cup)
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';

      [-12, 0, 12].forEach((xOff, i) => {
        ctx.beginPath();
        for (let y = 0; y < 25; y += 2) {
          const wave = Math.sin((y / 5) + (t * Math.PI * 2) + i) * 4;
          const px = 64 + xOff + wave;
          const py = 37 + bob - y;
          y === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
        }
        ctx.stroke();
      });

      // Cup body
      ctx.fillStyle = '#8B5A2B';
      ctx.fillRect(30, 45 + bob, 68, 55);

      // Cup rim
      ctx.fillStyle = '#A06E3C';
      ctx.fillRect(27, 40 + bob, 74, 7);

      // Handle
      ctx.strokeStyle = '#8B5A2B';
      ctx.lineWidth = 6;
      ctx.beginPath();
      ctx.arc(106, 75 + bob, 12, -Math.PI/2, Math.PI/2);
      ctx.stroke();

      // Coffee surface
      ctx.fillStyle = '#3C1E0A';
      ctx.beginPath();
      ctx.ellipse(64, 47 + bob, 29, 6, 0, 0, Math.PI * 2);
      ctx.fill();

      // Sunglasses
      const glassY = 65 + bob;
      ctx.fillStyle = '#141414';

      // Left lens
      ctx.beginPath();
      ctx.ellipse(48, glassY, 10, 8, 0, 0, Math.PI * 2);
      ctx.fill();

      // Right lens
      ctx.beginPath();
      ctx.ellipse(78, glassY, 10, 8, 0, 0, Math.PI * 2);
      ctx.fill();

      // Bridge
      ctx.strokeStyle = '#141414';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(58, glassY);
      ctx.lineTo(68, glassY);
      ctx.stroke();

      // Arms
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(38, glassY);
      ctx.lineTo(30, glassY - 5);
      ctx.moveTo(88, glassY);
      ctx.lineTo(96, glassY - 5);
      ctx.stroke();

      // Lens shine
      ctx.fillStyle = 'rgba(150, 150, 170, 0.5)';
      ctx.beginPath();
      ctx.ellipse(45, glassY - 3, 3, 2, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.beginPath();
      ctx.ellipse(75, glassY - 3, 3, 2, 0, 0, Math.PI * 2);
      ctx.fill();

      requestAnimationFrame(draw);
    }

    requestAnimationFrame(draw);
  </script>
</body>
</html>
